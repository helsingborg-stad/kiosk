function AlarmModel(e){e||(e={});var t=this;t.IDnr=e.IDnr,t.CaseID=e.CaseID,t.SentTime=e.SentTime,t.PresGrp=e.PresGrp,t.HtText=e.HtText,t.Address=e.Address,t.AddressDescription=e.AddressDescription,t.Name=e.Name,t.Zone=e.Zone,t.Position=e.Position,t.Comment=e.Comment,t.MoreInfo=e.MoreInfo,t.Place=e.Place,t.BigDisturbance=e.BigDisturbance,t.SmallDisturbance=e.SmallDisturbance,t.ChangeDate=e.ChangeDate,t.Station=e.Station,t.Cities=e.Cities}function TypeModel(e){e||(e={});var t=this;t.ID=e.ID,t.Name=e.EventTypesName}function AlarmPageModel(e){var t=this;t.alarms=ko.observableArray(ExtractModels(t,e,AlarmModel)),t.change=function(){jQuery("#selectedTypes").trigger("change")};var r=[{Type:"text",Name:"HÃ¤ndelse",Value:ko.observable(""),EventValue:function(e){return e.HtText+e.Comment+e.Address}},{Type:"text",Name:"Plats",Value:ko.observable(""),EventValue:function(e){return null!=e.Place?e.Place:""}},{Type:"calendar",Name:"Startdatum",CalendarID:"datetimepickerstart",Value:ko.observable(""),EventValue:function(e){return null!=e.SentTime?e.SentTime.substr(0,10):""}},{Type:"calendar",Name:"Slutdatum",CalendarID:"datetimepickerend",Value:ko.observable(""),EventValue:function(e){return null!=e.SentTime?e.SentTime.substr(0,10):""}}];t.filter=new FilterModel(r,t.alarms),t.pager=new PagerModel(t.filter.filteredAlarms)}function PagerModel(e){var t=this;t.events=GetObservableArray(e),t.currentPageIndex=ko.observable(t.events().length>0?0:-1),t.currentPageSize=7,t.eventCount=ko.computed(function(){return t.events().length}),t.maxPageIndex=ko.computed(function(){var e=Math.ceil(t.events().length/t.currentPageSize)-1;return e}),t.pagerPages=function(){var e=t.maxPageIndex(),r=t.currentPageIndex(),n=5,a=0,o=0;2>r?(a=1,o=n):r+n>e?(a=e-n,o=e):(a=r-1,o=r+3);for(var i=new Array,l=a;o>=l;l++)i.push(l);return i},t.currentPageEvents=ko.computed(function(){var e=-1,r=t.currentPageIndex(),n=t.maxPageIndex();if(e=r>n?n:-1==r?n>-1?0:-2:r,e!=r)return e>=-1&&t.currentPageIndex(e),[];var a=t.currentPageSize,o=r*a,i=o+a;return t.renderPagers(),t.events().slice(o,i)}).extend({throttle:5}),t.currentStatus=function(e){return t.currentPageIndex()==e?"current":""},t.isHidden=function(e){return t.maxPageIndex()>=e?!0:!1},t.moveFirst=function(){t.changePageIndex(0)},t.movePrevious=function(){t.changePageIndex(t.currentPageIndex()-1)},t.moveNext=function(){t.changePageIndex(t.currentPageIndex()+1)},t.moveLast=function(){t.changePageIndex(t.maxPageIndex())},t.changePageIndex=function(e){0>e||e==t.currentPageIndex()||e>t.maxPageIndex()||t.currentPageIndex(e)},t.onPageSizeChange=function(){t.currentPageIndex(0)},t.renderPagers=function(){t.pagerPages()},t.renderNoEvents=function(){var e='<span data-bind="visible: pager.eventCount() == 0">Hittade inga event.</span>';$("div.NoEvents").html(e)}}function FilterModel(e,t){var r=this;r.events=GetObservableArray(t),r.filters=ko.observableArray(e),r.activeFilters=ko.computed(function(){for(var e=r.filters(),t=[],n=0;n<e.length;n++){var a=e[n];if(a.CurrentOption){var o=a.CurrentOption();if(null!=o){var i={Filter:a,IsFiltered:function(e,t){var r=e.CurrentOption();if(r){var n=e.EventValue(t);return-1==r.indexOf(n)}}};t.push(i)}}else if(a.Value){var l=a.Value();if(l&&""!=l&&null!=l){var i={Filter:a,IsFiltered:function(e,t){var r=e.Value();r=r.toUpperCase();var n=e.EventValue(t);if(n=n.toUpperCase(),"calendar"==e.Type){var a=new Date(r),o=new Date(n);return e.Name.indexOf("Start")>-1?a>o:o>a}return-1==n.indexOf(r)}};t.push(i)}}}return t}),r.filteredAlarms=ko.computed(function(){var e=r.events(),t=r.activeFilters();if(0==t.length)return e;for(var n=[],a=0;a<e.length;a++){for(var o=!0,i=e[a],l=0;l<t.length;l++){var u=t[l],s=u.IsFiltered(u.Filter,i);if(s){o=!1;break}}o&&n.push(i)}return n}).extend({throttle:200})}function ExtractModels(e,t,r){var n=[];if(null==t)return n;for(var a=0;a<t.length;a++){var o=t[a],i=new r(o,e);n.push(i)}return n}function GetObservableArray(e){return"function"==typeof e?e:ko.observableArray(e)}function CompareCaseInsensitive(e,t){return null==e?null==t:null==t?!1:e.toUpperCase()<=t.toUpperCase()}function GetOption(e,t,r){var n={Name:e,Value:t,FilterValue:r};return n}function SortArray(e,t,r){if(null==e)return[];for(var n=0;n<e.length;n++)for(var a=e[n],o=n+1;o<e.length;o++){var i=e[o],l=r(a,i);l==t&&(e[o]=a,e[n]=i,a=i)}return e}function updateEvents(e){if(e.checked){var t={action:"load_events",ids:"0"};jQuery.post(ajaxurl,t,function(e){_alarmPageModel.alarms(ExtractModels(_alarmPageModel,JSON.parse(e),EventModel))})}else{var t={action:"load_events",ids:adminIDs};jQuery.post(ajaxurl,t,function(e){_alarmPageModel.alarms(ExtractModels(_alarmPageModel,JSON.parse(e),EventModel))})}}var _alarmPageModel=null;jQuery(document).ready(function(){var e={};$("#events-loading-indicator").show(),ko.bindingHandlers.trimText={init:function(e,t,r,n){var a=ko.computed(function(){var e=ko.utils.unwrapObservable(t()),r=250,n=e.length>r?e.substring(0,r-1)+"...":e,n=n.replace(/&nbsp;/gi," "),n=n.trim();return n});return ko.applyBindingsToNode(e,{text:a},n),{controlsDescendantBindings:!0}}},_alarmPageModel=new AlarmPageModel(e),ko.applyBindings(_alarmPageModel),$(document).on("click",".modal-link",function(e){e.preventDefault();for(var t,r=_alarmPageModel.alarms(),n=0;n<r.length;n++)if(r[n].IDnr===this.id){t=r[n];break}moreInfoText="-",""!=t.MoreInfo&&(moreInfoText=t.MoreInfo),$(".modalDate").text(t.SentTime),$(".modalEvent, .main-title").text(t.HtText),$(".modalStation").text(t.Station),$(".modalID").text(t.IDnr),$(".modalState").text(t.PresGrp),$(".modalAddress").text(t.Address),$(".modalLocation").text(t.Place),$(".modalArea").text(t.Zone),$(".modalMoreInfo").text(moreInfoText)});var t={action:"load_alarms"};jQuery.post(ajaxurl,t,function(e){_alarmPageModel.alarms(ExtractModels(_alarmPageModel,JSON.parse(e),AlarmModel)),$("#events-loading-indicator").hide()}),jQuery(function(){var e=new Date;e.setDate(e.getDate()),jQuery("#datetimepickerstart").datetimepicker({weeks:!0,lang:"se",timepicker:!1,format:"Y-m-d",formatDate:"Y-m-d",scrollMonth:!1,scrollTime:!1,scrollInput:!1,onShow:function(e){this.setOptions({maxDate:jQuery("#datetimepickerend").val()?jQuery("#datetimepickerend").val():!1})}}),jQuery("#datetimepickerend").datetimepicker({weeks:!0,lang:"se",timepicker:!1,format:"Y-m-d",formatDate:"Y-m-d",scrollMonth:!1,scrollTime:!1,scrollInput:!1,onShow:function(e){this.setOptions({minDate:jQuery("#datetimepickerstart").val()?jQuery("#datetimepickerstart").val():!1})}})})});